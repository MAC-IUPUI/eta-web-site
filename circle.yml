machine:
  node:
    version: 8.4.0
  environment:
    ETA_AUTH_PROVIDER: local
    ETA_DB_PROVIDER: postgres
    ETA_DB_HOST: localhost
    ETA_DB_PORT: 5432
    ETA_DB_USERNAME: ubuntu
    ETA_DB_DATABASE: circle_test
compile:
  override:
    - npm run eta -- generate indexes
    - npm run eta -- compile server
test:
  override:
    - npm run test:
        environment:
          MOCHA_FILE: $CIRCLE_TEST_REPORTS/junit/test-results.xml
deployment:
  staging:
    branch: master
    codedeploy:
      eta-v22-app:
        deployment_group: eta-v22-deployment-group
        deployment_config: CodeDeployDefault.OneAtATime
        application_root: /
        region: us-east-1
        revision_location:
          revision_type: S3
          s3_location:
            bucket: eta-deploy
            key_pattern: apps/eta-{SHORT_COMMIT}-{BUILD_NUM}
