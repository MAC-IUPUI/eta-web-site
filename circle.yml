machine:
  node:
    version: 8.4.0
  environment:
    ETA_AUTH_PROVIDER: local
    ETA_DB_PROVIDER: postgres
    ETA_DB_HOST: localhost
    ETA_DB_PORT: 5432
    ETA_DB_USERNAME: ubuntu
    ETA_DB_DATABASE: circle_test
checkout:
  post:
    - cp config/auth.sample.json config/auth.json
    - cp config/aws.sample.json config/aws.json
    - cp config/db.sample.json config/db.json
    - cp config/dev.sample.json config/dev.json
    - cp config/http.sample.json config/http.json
    - cp config/https.sample.json config/https.json
    - cp config/logger.sample.json config/logger.json
compile:
  override:
    - npm run eta -- generate indexes
    - npm run eta -- compile server
test:
  override:
    - npm run test:
        environment:
          MOCHA_FILE: $CIRCLE_TEST_REPORTS/junit/test-results.xml
# deployment:
#   production:
#     branch: master
#     codedeploy:
#       etaV22:
#         application_root: /app
#         revision_location:
#           revision_type: S3
#           s3_location:
#             bucket: eta-v22-bucket
#             key_pattern: apps/etaV22-{SHORT_COMMIT}-{BUILD_NUM}
#         region: us-east-2
#         deployment_group: etaV22-deployment-group
